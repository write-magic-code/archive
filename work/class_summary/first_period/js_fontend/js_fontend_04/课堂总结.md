# 04 最简单的 React 开发工具链及工具链简史

> 课程目的：
>
> - 了解如何使用 Vite 创建一个 React 项目
> - 了解前端打包工具链背后做的事情
> - 了解前端工具链的发展历史

React 有相当多的模板来快速搭建项目，这些模板会自动配置好依赖和工具，便于马上开始写代码。

## 为什么构建，为什么是 Vite

即使是最新的浏览器，内置的 js 引擎也无法满足开发者对**开发体验**的追求（哪怕只是跟 Node.js 这种比也差了很多）。就比如我们上文提到的 import 语句，Node.js 里是支持的，但在浏览器里用就受很多限制，而且很多新特性都需要转译才能在浏览器里运行，这就要求在开发的时候使用一些**工具链**来完成这些工作。

这个过程就是所谓的“**构建**”（build），而这些工具链就是所谓的“**构建工具**”（build tool）。     
构建工具的种类有很多，现在用的人最多的是 Webpack，但是它配置复杂不适合入门，暂且不提。而 Vite 是近几年出现的新星，它的特点是配置简单、启动快，适合新手入门，所以选择 Vite 来搭建我们的项目。

## 使用 Vite 创建项目

首先输入指令：`pnpm create vite`

然后根据需求选择项目放在什么文件夹，并在之后的选项里选择 react+ts，就能创建 React 项目了。

我们同样打开这个文件夹，然后运行：

```bash
pnpm dev
```

然后可以看到终端里输出了一个地址，打开这个地址就可以看到我们的项目了。

## 观察项目

打开这个项目，可以看到它的目录结构是这样的：

```
my-vite-app
├── node_modules
├── public
│   ├── favicon.ico
│   └── index.html
├── src
│   ├── App.css
│   ├── App.jsx
│   ├── index.css
│   └── main.jsx
├── .gitignore
├── package.json
└── vite.config.js
```

注意 `package.json` 里的 `scripts` ，可以看到 `dev`/`build`/`preview` 等字段，这就是可以在终端里运行的命令。

当然，你现在也就可以开始写 React 代码了，观察 `src/main.tsx` ，了解一下 React 是如何挂载到页面上的，然后就可以编辑 `src/App.tsx` 来写代码了。

> 注意：聪明的你可能根据此前的课 02 想到了，`.jsx`是 jsx 的文件后缀，那么 `.tsx` 自然是使用 typescript 编写的 jsx 文件的后缀。

## Vite 做了什么

分为两个部分讲述：开发时和构建时。

### 开发时

在开发过程中，Vite 会收集代码并将其转译为便于浏览器运行的格式，同时通过一个小型的 HTTP 服务器托管转译后的结果，以便在浏览器中查看编写的页面。

一般来说，大部分前端框架都有一些特色的语法，比如 React 的 JSX，Vue 的 SFC……这些的转译跟 Vite 本身无关，因此对于这类语法，需要用户配置对应的 Vite 插件来转译。幸运的是，创建 Vite 的时候这些插件都被自动配置好了。而 Vite 有庞大的插件生态，可以满足大部分需求，可以极大程度上改善开发体验（只要愿意花时间折腾）。

如果有兴趣的话，可以看 `vite.config.ts` 里的配置。

除此之外，大部分 Web 开发工具会提供提升开发体验的功能，比如其中最为重要的**热更新**，也就是在编辑代码的时候，浏览器里的页面会自动等待新的编译结果，然后自动刷新页面，这样就不用手动刷新页面了。

### 在构建时

在构建时，Vite 不仅将代码转译，还会做非常多的优化，比如：

1. 压缩：将代码中变量名、函数名等等压缩成更短的名字，减少文件大小
2. 拆分：将代码拆分成多个文件，让浏览器一次加载更多更小的文件，加快页面加载速度
3. Tree Shaking：将没有用到的代码删除，减少文件大小

通过这些优化，Vite 生成的代码会更小，加载速度更快，用户体验更好。这些在以往是需要配置大量工具及其插件并调整很多参数才能实现的，而 Vite 只需要一个命令就能完成。

## 前端工具链历史

早期前端开发没有工具链，维护起来十分痛苦，有很多重复的劳动，反复的使用各种工具优化代码。

于是出现了一些工具，比如 Grunt、Gulp，它们可以通过引入插件的方式，来自动执行一些重复的任务，这样就减少了很多重复的劳动。

但是对工具的简化是从来不会停止的，于是专门为前端开发设计的工具链出现了，比如 Webpack，它可以将代码转译、压缩、拆分、优化等等一系列工作都自动完成（，但是它只是一个一站式的工具，同样有极高的配置门槛，整个产业界对其爱恨交加）。

最终 Vite 出现了，它的设计牺牲了部分灵活性，但是换来的是极大程度的简化，哪怕是刚刚入门前端开发的新手也能马上上手。除此之外，Vite 比起 Webpack 更在意开发体验，**而不是「教你做对的事情」**，这也是它受欢迎的原因之一。

在最近几年，人们热衷于用原生语言重写前端工具链，其中 Vite 最初就在内部采用了 Go 语言编写的 esbuild，但是这并不够，马上就出现了大量完全由原生语言编写的打包工具，比如 Rspack、Turbopack 等，这又将前端工具链的使用体验提升到了一个新的高度。

无论人们如何抗拒，使用打包器为代表的一整套前端工具链已经成为了前端开发的标配，虽然学习起来可能细节繁多难以掌握，但是如果能融会贯通，那么自己和团队的开发效率将会得到极大的提升。
